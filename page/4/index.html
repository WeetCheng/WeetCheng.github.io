<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">









  
  
  <link rel="stylesheet" media="all" href="/lib/Han/dist/han.min.css?v=3.3">




<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.2" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.2">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.2" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.4.2',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">






  <link rel="canonical" href="http://yoursite.com/page/4/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Hexo</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />Tags</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />Categories</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />Search</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/05/dji-test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WeetCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/05/dji-test/" itemprop="url">
                  大疆嵌入式软件笔试题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-07-05 20:59:22" itemprop="dateCreated datePublished" datetime="2018-07-05T20:59:22+08:00">2018-07-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-07-06 19:20:48" itemprop="dateModified" datetime="2018-07-06T19:20:48+08:00">2018-07-06</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/05/dji-test/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/05/dji-test/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、编程题"><a href="#一、编程题" class="headerlink" title="一、编程题"></a>一、编程题</h3><p><strong>1. 有如下CAT_s结构体定义，回答：</strong></p>
<p>1) 在一台64位的机器上，使用32位编译，Garfield 变量占用多少内存空间？64位编译又是如何？（总分5分）</p>
<p>2) 使用32位编译情况下，给出一种判断所使用机器大小端的方法。（总分5分） </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CAT_s</span>&#123;</span></span><br><span class="line">  <span class="keyword">int</span> ld;</span><br><span class="line">  <span class="keyword">char</span> Color;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">short</span> Age;</span><br><span class="line">  <span class="keyword">char</span> *Name;</span><br><span class="line">  <span class="keyword">void</span>(*Jump)(<span class="keyword">void</span>);</span><br><span class="line">&#125;Garfield;</span><br></pre></td></tr></table></figure>
<p><strong>2. 描述下面XXX 这个宏的作用。（总分10分）</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> offsetof(TYPE,MEMBER)((size_t)&amp;((TYPE*)0)-&gt;MEMBER)	<span class="comment">// 计算MEMBER在结构体中的偏移量</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> container_of(ptr, type, member) (&#123;\          </span></span><br><span class="line">        const typeof( ((type *)0)-&gt;member ) *__mptr = (ptr);\    </span><br><span class="line">        (type *)( (<span class="keyword">char</span> *)__mptr - offsetof(type,member) );&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>3. 简述C 函数：</strong></p>
<p>1) 参数如何传递（__cdecl调用方式）；</p>
<p>2) 返回值如何传递；</p>
<p>3) 调用后如何 返回到调用前的下一条指令执行。（总分10分）</p>
<p><strong>答：</strong></p>
<p>1) __cdecl调用方式的三个特点：</p>
<ul>
<li>从右向左压入参数</li>
<li>由调用方负责参数压栈和清除栈(栈帧回退)</li>
<li>函数名会自动添加前导下划线</li>
</ul>
<blockquote>
<p>__stdcall<br>是StandardCall的缩写，是C++的标准调用方式：所有参数从右到左依次入栈，由调用者负责把参数压入栈，最后由<strong>被调用者</strong>负责清除栈的内容</p>
</blockquote>
<p>2) 返回值</p>
<ul>
<li>返回值小于等于4个字节时，存储在eax中</li>
<li>返回值5~8个字节时，eax和edx联合存储返回</li>
<li>返回值大于8个字节时，创建临时栈，返回值存在临时栈中</li>
</ul>
<p>3) 如何返回</p>
<p>完整介绍调用和返回的过程</p>
<p>调用过程：</p>
<ul>
<li>函数调用方将参数从右向左依次压入栈中</li>
<li>压入函数返回地址</li>
<li>pushl %ebp; movl %esp %ebp;</li>
<li>保存在函数调用过程中需要保持不变的寄存器，如ebx,esi,edi</li>
<li>被调用函数保存临时变量</li>
</ul>
<p>返回过程：</p>
<ul>
<li>movl %ebp, %esp; popl %ebp</li>
<li>弹出函数返回地址到程序计数器PC中</li>
</ul>
<h3 id="二．嵌入式基本知识"><a href="#二．嵌入式基本知识" class="headerlink" title="二．嵌入式基本知识"></a>二．嵌入式基本知识</h3><p><strong>1. 简述处理器中断处理的过程（中断向量、中断保护现场、中断嵌套、中断返回等）。（总 分10分）</strong></p>
<ul>
<li>外设产生中断信号，经过中断控制器进行筛选，选出中断优先级比较高的中断信号，把中断号传给CPU</li>
<li>CPU禁用中断</li>
<li>CPU根据中断号，查找中断向量表，获得对应的中断服务程序的地址</li>
<li>CPU将一些重要的寄存器的内容压入堆栈中，如CS,EIP,SS,ESP,EFLAG</li>
<li>跳转到中断服务程序，CPU重新允许中断</li>
<li>执行中断服务例程，如何此时又有其他中断信号产生，重复以上步骤</li>
<li>中断返回时，需要先禁用中断</li>
<li>将堆栈中的寄存器弹回，回到原来的程序中</li>
<li>重新允许中断</li>
</ul>
<p><strong>2. 简述处理器在读内存的过程中，CPU 核、cache 、MMU 如何协同工作？画出CPU 核、 cache 、MMU 、内存之间的关系示意图加以说明（可以以你熟悉的处理器为例）。（总分10分）</strong></p>
<h3 id="三．基本通信知识"><a href="#三．基本通信知识" class="headerlink" title="三．基本通信知识"></a>三．基本通信知识</h3><p><strong>1. 请说明总线接口USRT 、I2C 、USB 的异同点（串/并、速度、全/半双工、总线拓扑等）。 （总分5分）</strong></p>
<p>UART 通用异步串行口，速率不快，可全双工，结构上一般由波特率产生器、UART发送器、UART接收器组成，硬件上两线，一收一发。 </p>
<p>SPI 高速同步串行口，高速，可全双工，收发独立，同步接口，可实现多个SPI设备互联，硬件3~4线。</p>
<p>I2C 双向、两线、串行、多主控接口标准。速率不快，半双工，同步接口，具有总线仲裁机制，非常适合器件间近距离经常性数据通信，可实现设备组网。</p>
<p>USB 通用串行总线，高速，半双工，由主机、hub、设备组成。设备可以与下级hub相连构成星型结构。</p>
<p>以表格总结如下：</p>
<p><img src="http://p65ksscu3.bkt.clouddn.com/18-7-6/43563438.jpg" alt=""></p>
<p><strong>2. 列举你所知道的linux 内核态和用户态之间的通信方式并给出你认为效率最高的方式， 说明理由。（总分5分）</strong></p>
<h3 id="四．系统设计"><a href="#四．系统设计" class="headerlink" title="四．系统设计"></a>四．系统设计</h3><p>有一个使用UART 进行通信的子系统X ，其中UART0进行数据包接收和回复，UART1进行数据包转发。子系统X 的通信模块职责是从UART0接收数据包，如果为本地数据包（receiver 为子系统X ），则解析数据包中的命令码（2字节）和数据域（0~128字节），根据命令码调用内部的处理程序，并将处理结果通过UART0回复给发送端，如果非本地数据包，则通过UART1转发。</p>
<p>如果由你来设计子系统X 的通信模块：</p>
<p>1) 请设计通信数据包格式，并说明各字段的定义；（总分5分）</p>
<p>2) 在一个实时操作系统中，你会如何部署模块中的任务和缓存数据，画出任务间的数据流视图加以说明；（总分5分）</p>
<p>3) 你会如何设置任务的优先级，说说优缺点；（总分5分）</p>
<p>4) 如果将命令码对应的处理优先级分为高、低两个等级，你又会如何设计；（总分5分）</p>
<h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><p>[1] <a href="http://www.voidcn.com/article/p-kznzcojw-gy.html" target="_blank" rel="noopener">2014年大疆创新笔试题目</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/05/C和C++/C语言/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WeetCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/05/C和C++/C语言/" itemprop="url">
                  C语言部分知识点
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-07-05 17:06:32" itemprop="dateCreated datePublished" datetime="2018-07-05T17:06:32+08:00">2018-07-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-18 12:52:41" itemprop="dateModified" datetime="2018-09-18T12:52:41+08:00">2018-09-18</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/05/C和C++/C语言/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/05/C和C++/C语言/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p><strong>C语言中带负数的除法</strong></p>
<p>做除法的时候，商是令其与除数相乘的积的绝对值不超过被除数的绝对值且最接近的那个数。</p>
<p>(-10)/3==-3;<br>10/(-3)==-3;<br>(-10)/(-3)==3;</p>
<p>(-10)%3==-1;<br>10%(-3)==1;<br>(-10)%(-3)==-1;</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/04/数据结构与算法/data-structure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WeetCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/04/数据结构与算法/data-structure/" itemprop="url">
                  大话数据结构
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-07-04 14:56:12 / Modified: 15:36:19" itemprop="dateCreated datePublished" datetime="2018-07-04T14:56:12+08:00">2018-07-04</time>
            

            
              

              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/04/数据结构与算法/data-structure/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/04/数据结构与算法/data-structure/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h3 id="逻辑结构与物理结构"><a href="#逻辑结构与物理结构" class="headerlink" title="逻辑结构与物理结构"></a>逻辑结构与物理结构</h3><p>逻辑结构：</p>
<ul>
<li>线性表</li>
<li>树</li>
<li>图</li>
</ul>
<p>物理结构：</p>
<ul>
<li>顺序存储</li>
<li>链式存储</li>
<li>索引存储</li>
<li>散列存储</li>
</ul>
<h3 id="线性表"><a href="#线性表" class="headerlink" title="线性表"></a>线性表</h3><p>线性表的抽象数据结构</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化线性表</span></span><br><span class="line">InitList(*L);</span><br><span class="line"><span class="comment">// 判断线性表是否为空</span></span><br><span class="line">IsEmptyList(L);</span><br><span class="line"><span class="comment">// 获取线性表的长度</span></span><br><span class="line">ListLength(L);</span><br><span class="line"><span class="comment">// 删除线性表</span></span><br><span class="line">ClearList(*L);</span><br><span class="line"><span class="comment">// 线性表中插入元素</span></span><br><span class="line">ListInsert(*L, i ,e);</span><br><span class="line"><span class="comment">// 线性表中删除元素</span></span><br><span class="line">ListDelete(*L, i, *e);</span><br><span class="line"><span class="comment">// 获取指定位置的元素</span></span><br><span class="line">GetElement(L, i, *e);</span><br><span class="line"><span class="comment">// 获取某个元素所在的位置</span></span><br><span class="line">LocateElement(L, e);</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/30/操作系统/linux-transplant/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WeetCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/30/操作系统/linux-transplant/" itemprop="url">
                  linux-transplant
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-30 20:49:30 / Modified: 21:09:34" itemprop="dateCreated datePublished" datetime="2018-06-30T20:49:30+08:00">2018-06-30</time>
            

            
              

              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/30/操作系统/linux-transplant/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/30/操作系统/linux-transplant/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Linux编译初体验"><a href="#Linux编译初体验" class="headerlink" title="Linux编译初体验"></a>Linux编译初体验</h3><p>首先下载好100ask提供的Linux内核包和补丁</p>
<p>linux-2.6.22.6.tar.bz2</p>
<p>linux-2.6.22.6_jz2440.patch</p>
<p><strong>编译初体验步骤</strong></p>
<ol>
<li>打补丁</li>
<li>找到类似的板子，使用其默认配置，</li>
<li>在默认配置基础上make menuconfig做修改,两步配置的结果是生成.config文件</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ tar jxvf linux-2.6.22.6.tar.bz2</span><br><span class="line">$ <span class="built_in">cd</span> linux-2.6.22.6</span><br><span class="line">$ patch -p1 &lt; ../linux-2.6.22.6_jz2440.patch</span><br><span class="line">$ make s3c2410_defconfig	<span class="comment"># 先做默认配置，位于/arch/arm/configs目录下，配置结果会保存在.config文件中。</span></span><br></pre></td></tr></table></figure>
<p>make s3c2410_defconfig报错，因为make版本太新</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Makefile:416: *** mixed implicit and normal rules: deprecated syntax</span><br><span class="line">Makefile:1449: *** mixed implicit and normal rules: deprecated syntax</span><br><span class="line">make: *** No rule to make target <span class="string">'s3c2410_defconfig'</span>。 停止。</span><br></pre></td></tr></table></figure>
<p>根据错误提示修改这两行的内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">416     config %config: scripts_basic outputmakefile FORCE</span><br><span class="line">改成	   %config: scripts_basic outputmakefile FORCE</span><br><span class="line"></span><br><span class="line">1449	/ %/: prepare scripts FORCE</span><br><span class="line">改成	   %/: prepare scripts FORCE</span><br></pre></td></tr></table></figure>
<p>重新make s3c2410_defconfig，成功。</p>
<p>百问网已经提供了完整的配置文件config_ok(根目录下)，因此可以复制.config</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cp config_ok .config</span><br><span class="line">$ make menuconfig</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/28/嵌入式/uboot-transplant/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WeetCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/28/嵌入式/uboot-transplant/" itemprop="url">
                  uboot移植过程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-28 21:35:09" itemprop="dateCreated datePublished" datetime="2018-06-28T21:35:09+08:00">2018-06-28</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-06-30 20:49:35" itemprop="dateModified" datetime="2018-06-30T20:49:35+08:00">2018-06-30</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/28/嵌入式/uboot-transplant/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/28/嵌入式/uboot-transplant/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h3 id="uboot初体验"><a href="#uboot初体验" class="headerlink" title="uboot初体验"></a>uboot初体验</h3><p><strong>工作环境</strong></p>
<ul>
<li>make 4.1</li>
<li>arm-linux-gcc 3.4.5</li>
<li>oflash——使用100ask.org提供的Linux下的oflash工具</li>
</ul>
<p><strong>配置编译过程</strong></p>
<ul>
<li>解压缩</li>
<li>打补丁：patch -p1 &lt; ../补丁文件</li>
<li>配置：make 100ask24x0_config</li>
<li>编译：make</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tar jxvf u-boot-1.1.6.tar.bz2</span><br><span class="line">$ <span class="built_in">cd</span> u-boot-1.1.6</span><br><span class="line">$ patch -p1 &lt; ../u-boot-1.1.6_jz2440.patch</span><br><span class="line">$ make 100ask24x0_config</span><br><span class="line">$ make</span><br></pre></td></tr></table></figure>
<p>最开始make的时候报错：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Makefile:327: target <span class="string">'u-boot-1.1.6'</span> given more than once <span class="keyword">in</span> the same rule</span><br></pre></td></tr></table></figure>
<p>经过查找，原因在于我的交叉编译链arm-linux-gcc版本太新，最后换成arm-linux-gcc-3.4.5版本，就可以了</p>
<p>同样的道理后面移植Linux内核的时候，make也报错，那是因为make版本太新</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Makefile:416: *** mixed implicit and normal rules: deprecated syntax</span><br><span class="line">Makefile:1449: *** mixed implicit and normal rules: deprecated syntax</span><br><span class="line">make: *** No rule to make target <span class="string">'s3c2410_defconfig'</span>。 停止。</span><br></pre></td></tr></table></figure>
<p>根据错误提示修改这两行的内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">416     config %config: scripts_basic outputmakefile FORCE</span><br><span class="line">改成	   %config: scripts_basic outputmakefile FORCE</span><br><span class="line"></span><br><span class="line">1449	/ %/: prepare scripts FORCE</span><br><span class="line">改成	   %/: prepare scripts FORCE</span><br></pre></td></tr></table></figure>
<p><strong>烧录uboot.bin</strong></p>
<p>make成功之后会在uboot的根目录下生成u-boot,u-boot.bin,u-boot.srec.可以将u-boot.bin烧录到Nand flash上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ oflash u-boot.bin</span><br><span class="line"><span class="comment"># 根据提示，依次输入 0 1 0 0 0，将u-boot.bin烧录到Nand flash中。</span></span><br></pre></td></tr></table></figure>
<p><strong>uboot简介</strong></p>
<p>uboot支持菜单和命令</p>
<p>常用命令</p>
<p>print——打印环境变量</p>
<p>menu——显示uboot菜单</p>
<p>set——设环境变量 set bootdelay 10</p>
<p>save——保存环境变量,直接输入 save</p>
<p>reset——重启</p>
<p><strong>uboot的核心功能</strong></p>
<p>从flash中读出内核，放到SDRAM中，启动内核。因此uboot需要有以下功能：</p>
<ul>
<li>硬件初始化，包括关看门狗，初始化时钟，初始化SDRAM等</li>
<li>从Flash中读取内核到SDRAM</li>
<li>启动内核</li>
</ul>
<p>另外为了开发方便，添加额外的功能</p>
<ul>
<li>烧写flash</li>
<li>网卡</li>
<li>usb</li>
<li>串口</li>
</ul>
<h3 id="配置命令分析"><a href="#配置命令分析" class="headerlink" title="配置命令分析"></a>配置命令分析</h3><p>分析配置命令<code>make 100ask24x0_config</code>，查看Makefile可知</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">100ask24x0_config	:	unconfig</span><br><span class="line">	@$(MKCONFIG) $(@:_config=) arm arm920t 100ask24x0 NULL s3c24x0</span><br><span class="line"><span class="comment"># ./mkconfig 100ask24x0 arm arm920t 100ask24x0 NULL s3c24x0</span></span><br><span class="line"><span class="comment">#     $0		$1		 $2		$3		$4		$5		$6</span></span><br></pre></td></tr></table></figure>
<p>于是可以知道，会去执行./mkconfig脚本，查看mkconfig，其主要完成的动作为</p>
<ul>
<li><p>创建include下的快捷方式</p>
<ul>
<li>创建include目录</li>
<li>在include目录下为asm-arm创建一个快捷方式为asm</li>
<li>在asm(asm-arm)目录下创建arch-s3c2440目录，同时创建其快捷方式为arch目录</li>
<li>在asm(asm-arm)目录下为proc-arm目录创建其快捷方式为proc目录</li>
</ul>
</li>
<li><p>在include目录下创建config.mk文件，内容如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ARCH   = arm</span><br><span class="line">CPU    = arm920t</span><br><span class="line">BOARD  = 100ask24x0</span><br><span class="line">SOC    = s3c24x0</span><br></pre></td></tr></table></figure>
</li>
<li><p>在include目录下创建config.h文件，内容如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/* Automatically generated - <span class="keyword">do</span> not edit */</span><br><span class="line"><span class="comment">#include &lt;configs/100ask24x0.h&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="编译分析"><a href="#编译分析" class="headerlink" title="编译分析"></a>编译分析</h3><p>编译命令<code>make</code></p>
<p>执行make命令，在运行时最后面输出的内容，先大概浏览一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">UNDEF_SYM=`arm-linux-objdump -x lib_generic/libgeneric.a board/100ask24x0/lib100ask24x0.a cpu/arm920t/libarm920t.a cpu/arm920t/s3c24x0/libs3c24x0.a lib_arm/libarm.a fs/cramfs/libcramfs.a fs/fat/libfat.a fs/fdos/libfdos.a fs/jffs2/libjffs2.a fs/reiserfs/libreiserfs.a fs/ext2/libext2fs.a net/libnet.a disk/libdisk.a rtc/librtc.a dtt/libdtt.a drivers/libdrivers.a drivers/nand/libnand.a drivers/nand_legacy/libnand_legacy.a drivers/usb/libusb.a drivers/sk98lin/libsk98lin.a common/libcommon.a |sed  -n -e <span class="string">'s/.*\(__u_boot_cmd_.*\)/-u\1/p'</span>|sort|uniq`;\</span><br><span class="line">	<span class="built_in">cd</span> /media/cheng/work/uboot_transplant/u-boot-1.1.6 &amp;&amp; arm-linux-ld -Bstatic -T /media/cheng/work/uboot_transplant/u-boot-1.1.6/board/100ask24x0/u-boot.lds -Ttext 0x33F80000  <span class="variable">$UNDEF_SYM</span> cpu/arm920t/start.o \</span><br><span class="line">		--start-group lib_generic/libgeneric.a board/100ask24x0/lib100ask24x0.a cpu/arm920t/libarm920t.a cpu/arm920t/s3c24x0/libs3c24x0.a lib_arm/libarm.a fs/cramfs/libcramfs.a fs/fat/libfat.a fs/fdos/libfdos.a fs/jffs2/libjffs2.a fs/reiserfs/libreiserfs.a fs/ext2/libext2fs.a net/libnet.a disk/libdisk.a rtc/librtc.a dtt/libdtt.a drivers/libdrivers.a drivers/nand/libnand.a drivers/nand_legacy/libnand_legacy.a drivers/usb/libusb.a drivers/sk98lin/libsk98lin.a common/libcommon.a --end-group -L /home/cheng/ProgramFiles/Portable/gcc-3.4.5-glibc-2.3.6/bin/../lib/gcc/arm-linux/3.4.5 -lgcc \</span><br><span class="line">		-Map u-boot.map -o u-boot</span><br><span class="line">arm-linux-objcopy --gap-fill=0xff -O srec u-boot u-boot.srec</span><br><span class="line">arm-linux-objcopy --gap-fill=0xff -O binary u-boot u-boot.bin</span><br></pre></td></tr></table></figure>
<p>可以看到中间部分是编译的主要内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arm-linux-ld -Bstatic -T /media/cheng/work/uboot_transplant/u-boot-1.1.6/board/100ask24x0/u-boot.lds -Ttext 0x33F80000  <span class="variable">$UNDEF_SYM</span> cpu/arm920t/start.o \</span><br><span class="line">		--start-group lib_generic/libgeneric.a board/100ask24x0/lib100ask24x0.a cpu/arm920t/libarm920t.a cpu/arm920t/s3c24x0/libs3c24x0.a lib_arm/libarm.a fs/cramfs/libcramfs.a fs/fat/libfat.a fs/fdos/libfdos.a fs/jffs2/libjffs2.a fs/reiserfs/libreiserfs.a fs/ext2/libext2fs.a net/libnet.a disk/libdisk.a rtc/librtc.a dtt/libdtt.a drivers/libdrivers.a drivers/nand/libnand.a drivers/nand_legacy/libnand_legacy.a drivers/usb/libusb.a drivers/sk98lin/libsk98lin.a common/libcommon.a --end-group -L /home/cheng/ProgramFiles/Portable/gcc-3.4.5-glibc-2.3.6/bin/../lib/gcc/arm-linux/3.4.5 -lgcc \</span><br><span class="line">		-Map u-boot.map -o u-boot</span><br></pre></td></tr></table></figure>
<p>分成三个部分，一是链接脚本，二是链接的原材料(包括.o文件和.a文件)，三是输出文件(u-boot)</p>
<p><strong>链接脚本路径</strong></p>
<p>/media/cheng/work/uboot_transplant/u-boot-1.1.6/board/100ask24x0/u-boot.lds</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">OUTPUT_FORMAT(<span class="string">"elf32-littlearm"</span>, <span class="string">"elf32-littlearm"</span>, <span class="string">"elf32-littlearm"</span>)</span><br><span class="line">/*OUTPUT_FORMAT(<span class="string">"elf32-arm"</span>, <span class="string">"elf32-arm"</span>, <span class="string">"elf32-arm"</span>)*/</span><br><span class="line">OUTPUT_ARCH(arm)</span><br><span class="line">ENTRY(_start)</span><br><span class="line">SECTIONS</span><br><span class="line">&#123;</span><br><span class="line">	. = 0x00000000;		// 链接时设置了-Ttext 0x33F80000,因此要加上该偏移量，才是加载时的地址</span><br><span class="line"></span><br><span class="line">	. = ALIGN(4);</span><br><span class="line">	.text      :</span><br><span class="line">	&#123;</span><br><span class="line">	  cpu/arm920t/start.o	(.text)			//整个elf文件从cpu/arm920t/start.o的代码段开始</span><br><span class="line">          board/100ask24x0/boot_init.o (.text)</span><br><span class="line">	  *(.text)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	. = ALIGN(4);</span><br><span class="line">	.rodata : &#123; *(.rodata) &#125;</span><br><span class="line"></span><br><span class="line">	. = ALIGN(4);</span><br><span class="line">	.data : &#123; *(.data) &#125;</span><br><span class="line"></span><br><span class="line">	. = ALIGN(4);</span><br><span class="line">	.got : &#123; *(.got) &#125;</span><br><span class="line"></span><br><span class="line">	. = .;</span><br><span class="line">	__u_boot_cmd_start = .;</span><br><span class="line">	.u_boot_cmd : &#123; *(.u_boot_cmd) &#125;</span><br><span class="line">	__u_boot_cmd_end = .;</span><br><span class="line"></span><br><span class="line">	. = ALIGN(4);</span><br><span class="line">	__bss_start = .;</span><br><span class="line">	.bss : &#123; *(.bss) &#125;</span><br><span class="line">	_end = .;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>分析make</strong></p>
<ul>
<li>阅读cpu/arm920t/start.S——因为从链接脚本看出整个elf文件从cpu/arm920t/start.o的代码段开始</li>
<li>board/100ask24x0/u-boot.lds，和 0x33F80000——分析链接地址</li>
</ul>
<p>JZ2440的SDRAM为64MB，地址从0x3000000开始，最高的512KB的空间用来存放uboot。如果你的uboot比较大，则可以适当调整TextBase</p>
<p><img src="http://p65ksscu3.bkt.clouddn.com/18-6-29/5068079.jpg" alt=""></p>
<h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><p>系统时钟MPLL为400MHz</p>
<ul>
<li>uboot第一阶段——硬件初始化<ul>
<li>进入管理模式SVC</li>
<li>关闭看门狗</li>
<li>屏蔽中断</li>
<li>初始化SDRAM</li>
<li>设置栈</li>
<li>时钟</li>
<li>代码重定位（从flash复制到SDRAM中）</li>
<li>清BSS段</li>
<li>调用start_armboot</li>
</ul>
</li>
<li>uboot第二阶段<ul>
<li>uboot菜单</li>
<li>uboot启动内核</li>
</ul>
</li>
</ul>
<p><strong>uboot启动内核</strong></p>
<p>分区概念：PC上每个硬盘都有分区表，但是在嵌入式Linux的flash中没有分区表</p>
<p>在arm中“分区”其实是规划好之后，固定好每个分区的起始地址和大小</p>
<p>uboot中输入mtd命令之后，可以查看分区信息</p>
<p>nand flash有64MB，SDRAM为64MB</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">device nand0 &lt;nandflash0&gt;, <span class="comment"># parts = 4</span></span><br><span class="line"> <span class="comment">#: name			size		offset		mask_flags</span></span><br><span class="line"> 0: bootloader          0x00040000	0x00000000	0</span><br><span class="line"> 1: params              0x00020000	0x00040000	0</span><br><span class="line"> 2: kernel              0x00200000	0x00060000	0</span><br><span class="line"> 3: root                0x0fda0000	0x00260000	0</span><br><span class="line"></span><br><span class="line">active partition: nand0,0 - (bootloader) 0x00040000 @ 0x00000000</span><br><span class="line"></span><br><span class="line">defaults:</span><br><span class="line">mtdids  : nand0=nandflash0</span><br><span class="line">mtdparts: mtdparts=nandflash0:256k@0(bootloader),128k(params),2m(kernel),-(root)</span><br></pre></td></tr></table></figure>
<p>uboot中输入print命令之后，可以查看参数信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">bootcmd=nand read.jffs2 0x30007FC0 kernel; </span><br><span class="line"><span class="comment"># bootcmd=nand read.jffs2 0x30007FC0 0x00200000; bootm 0x30007FC0</span></span><br><span class="line"><span class="comment"># 这里的kernel用于代替分区的起始地址0x00060000，偏移量0x00200000</span></span><br><span class="line"><span class="comment"># 表示从kernel分区中读取</span></span><br><span class="line">bootm 0x30007FC0</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>启动内核需要两条命令</p>
<ul>
<li>nand read.jffs2 0x30007FC0 kernel——将nand flash的kernel分区读到0x30007FC0，读出内核</li>
<li>bootm 0x30007FC0——启动内核<ul>
<li>根据头部移动内核到合适的地方（uImage头部定好了加载地址为0x30008000）</li>
<li>启动do_bootm_linux<ul>
<li>uboot告诉内核，相关的启动参数（参数地址在0x30000100，然后按照固定格式开始存放）</li>
<li>跳到入口地址</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>flash上存的内核uImage，其格式为：头部+真正的内核</p>
<p>内核参数格式如下：</p>
<ul>
<li>setup_start_tag</li>
<li>setup_memory_tags</li>
<li>setup_commandline_tag</li>
<li>setup_end_tag</li>
</ul>
<p>环境变量</p>
<ul>
<li>默认</li>
<li>flash上保存的</li>
</ul>
<p><strong>uboot的两个主要的功能</strong></p>
<p>（1）uboot启动内核</p>
<ol>
<li>start_armboot</li>
<li>flash_init</li>
<li>nand_init</li>
<li>main_loop</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s=getenv(<span class="string">"boot_cmd"</span>);	<span class="comment">// 获取boot_cmd环境变量，而boot_cmd环境变量的内容就是启动命令</span></span><br><span class="line">run_command(s,..);		<span class="comment">// 运行命令</span></span><br></pre></td></tr></table></figure>
<p>（2）uboot界面</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">readline(); 			<span class="comment">// 读串口</span></span><br><span class="line">run_command();			<span class="comment">// 运行命令</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/27/preparing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WeetCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/27/preparing/" itemprop="url">
                  知识点准备
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-27 20:33:14" itemprop="dateCreated datePublished" datetime="2018-06-27T20:33:14+08:00">2018-06-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-06-28 21:15:58" itemprop="dateModified" datetime="2018-06-28T21:15:58+08:00">2018-06-28</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/27/preparing/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/27/preparing/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p><strong>1. DSP和ARM有什么区别？</strong></p>
<p><strong>2. 设备的独立性</strong></p>
<p>应用程序独立于具体使用的物理设备</p>
<p><strong>3. 进程上下文是进程执行全过程的静态描述</strong></p>
<p><strong>4. 静态优先和动态优先，是否会饥饿</strong></p>
<p>静态优先算法，不管是可抢占的还是不可抢占的，低优先级进程都有可能饥饿</p>
<p>动态优先算法则不会，因为会随着等待时间的增加而提高进程的优先级</p>
<p><strong>5. 死锁的处理方法</strong></p>
<ul>
<li>鸵鸟策略——系统发生死锁的可能性/频率比较小，则不用管是否会死锁，等发生了死锁导致系统崩溃，重启即可</li>
<li>预防策略</li>
<li>避免策略</li>
<li>检测与解除死锁</li>
</ul>
<h3 id="ARM嵌入式"><a href="#ARM嵌入式" class="headerlink" title="ARM嵌入式"></a>ARM嵌入式</h3><p><strong>1. Nand和Nor的区别</strong></p>
<table>
<thead>
<tr>
<th>指标</th>
<th>Nor</th>
<th>Nand</th>
</tr>
</thead>
<tbody>
<tr>
<td>容量</td>
<td>小，1MB~32MB</td>
<td>16MB~512MB</td>
</tr>
<tr>
<td>片上运行(XIP)</td>
<td>支持XIP</td>
<td>不支持XIP</td>
</tr>
<tr>
<td>性能</td>
<td>读写擦除都很快</td>
<td>读快，写慢，擦除特别慢</td>
</tr>
<tr>
<td>生命周期</td>
<td>长</td>
<td>短</td>
</tr>
<tr>
<td>接口</td>
<td>RAM接口</td>
<td>I/O接口</td>
</tr>
<tr>
<td>访问顺序</td>
<td>随机访问</td>
<td>顺序访问</td>
</tr>
<tr>
<td>主要用途</td>
<td>保存代码和关键数据</td>
<td>保存数据（不支持XIP，不能保存程序）</td>
</tr>
<tr>
<td>价格</td>
<td>贵</td>
<td>便宜</td>
</tr>
</tbody>
</table>
<p><strong>2. Nand的访问</strong></p>
<p>物理连接：</p>
<ul>
<li>片选线</li>
<li>数据线</li>
<li>地址锁存线</li>
<li>命令锁存线</li>
<li>读使能线</li>
<li>写使能线</li>
<li>就绪/忙输出线</li>
</ul>
<p>使用方法</p>
<p>传命令字 -&gt; 传地址 -&gt; 读/写数据</p>
<p><strong>3. Nand参数</strong></p>
<p>64MB，26根地址线</p>
<p>组织方式，一页512B，一块32页，总共4096块，即128K页</p>
<p><strong>4. S3C2440的地址空间</strong></p>
<ul>
<li>地址空间总共有1GB，分成8个Bank</li>
<li>每个bank可以设置总线位宽（8/16/32bit）</li>
<li>支持外接ROM，SRAM，SDRAM</li>
</ul>
<p><strong>5. S3C2440的外设</strong></p>
<p>Nor flash,SDRAM,网卡，IDE接口，串口芯片</p>
<p><strong>6. 三种存储器</strong></p>
<p>Nand——I/O接口，程序不能在片上运行，只能存放数据，相当于硬盘</p>
<p>Nor——内存接口，支持片上运行，可以存放程序和数据</p>
<p>SDRAM——内存接口，支持片上运行，相当于内存</p>
<p><strong>7. S3C2440启动方式</strong></p>
<p>启动地址固定为0地址，</p>
<ul>
<li>从Nor启动——Nor地址会被映射到0地址，因此可以从Nor开始执行程序。</li>
<li>从Nand启动——Nand使用的I/O接口，刚上电时，未进行I/O初始化，不能读取，芯片内部设计，当选择从Nand启动时，硬件自动复制Nand的前4K的内容到steppingstone中，并且此时steppingstone被映射到0地址，因此从steppingstone中开始执行程序。因为SDRAM具有更好的性能，因此，一般会再将steppingstone的内容复制到SDRAM中，运行。</li>
</ul>
<p><strong>8. 操作SDRAM</strong></p>
<ul>
<li>关闭看门狗，否则CPU会不断重启</li>
<li>设置存储控制器（13个）：位宽和等待控制寄存器，8个Bank控制寄存器，3个SDRAM的相关寄存器</li>
<li>复制代码到SDRAM中</li>
<li>设置栈（有了栈才可以使用函数）</li>
<li>跳转到SDRAM中运行程序</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/25/日常/vscode-skills/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WeetCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/25/日常/vscode-skills/" itemprop="url">
                  vscode-skills
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-25 10:26:53" itemprop="dateCreated datePublished" datetime="2018-06-25T10:26:53+08:00">2018-06-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-07-05 08:59:36" itemprop="dateModified" datetime="2018-07-05T08:59:36+08:00">2018-07-05</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/25/日常/vscode-skills/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/25/日常/vscode-skills/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>转载自</p>
<p>CSDN博客：<a href="https://blog.csdn.net/crper/article/details/54099319" target="_blank" rel="noopener">VS Code折腾记 - (2) 快捷键大全，没有更全</a></p>
<p>作者：<a href="https://blog.csdn.net/crper" target="_blank" rel="noopener">CRPER</a></p>
<p><strong>vscode列复制：</strong></p>
<p>alt + shift + 鼠标左键选择</p>
<p>函数跳转：ctrl+鼠标左键</p>
<p>函数跳转返回：ctrl+alt+-</p>
<hr>
<h1 id="VsCode-快捷键有五种组合方式（科普）"><a href="#VsCode-快捷键有五种组合方式（科普）" class="headerlink" title="VsCode 快捷键有五种组合方式（科普）"></a>VsCode 快捷键有五种组合方式（科普）</h1><ol>
<li><code>Ctrl + Shift + ?</code> : 这种常规组合按钮</li>
<li><code>Ctrl + V Ctrl +V</code> : 同时依赖一个按键的组合</li>
<li><code>Shift + V c</code> : 先组合后单键的输入</li>
<li><code>Ctrl + Click</code>: 键盘 + 鼠标点击</li>
<li><code>Ctrl + DragMouse</code> : 键盘 + 鼠标拖动</li>
</ol>
<hr>
<h1 id="通用快捷键"><a href="#通用快捷键" class="headerlink" title="通用快捷键"></a>通用快捷键</h1><table>
<thead>
<tr>
<th>快捷键</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ctrl+Shift+P,F1</td>
<td>展示全局命令面板</td>
</tr>
<tr>
<td>Ctrl+P</td>
<td>快速打开最近打开的文件</td>
</tr>
<tr>
<td>Ctrl+Shift+N</td>
<td>打开新的编辑器窗口</td>
</tr>
<tr>
<td>Ctrl+Shift+W</td>
<td>关闭编辑器</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="基础编辑"><a href="#基础编辑" class="headerlink" title="基础编辑"></a>基础编辑</h1><table>
<thead>
<tr>
<th>快捷键</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ctrl + X</td>
<td>剪切</td>
</tr>
<tr>
<td>Ctrl + C</td>
<td>复制</td>
</tr>
<tr>
<td>Alt + up/down</td>
<td>移动行上下</td>
</tr>
<tr>
<td>Shift + Alt up/down</td>
<td>在当前行上下复制当前行</td>
</tr>
<tr>
<td>Ctrl + Shift + K</td>
<td>删除行</td>
</tr>
<tr>
<td>Ctrl + Enter</td>
<td>在当前行下插入新的一行</td>
</tr>
<tr>
<td>Ctrl + Shift + Enter</td>
<td>在当前行上插入新的一行</td>
</tr>
<tr>
<td>Ctrl + Shift + \</td>
<td>匹配花括号的闭合处，跳转</td>
<td></td>
</tr>
<tr>
<td>Ctrl + ] / [</td>
<td>行缩进</td>
</tr>
<tr>
<td>Home</td>
<td>光标跳转到行头</td>
</tr>
<tr>
<td>End</td>
<td>光标跳转到行尾</td>
</tr>
<tr>
<td>Ctrl + Home</td>
<td>跳转到页头</td>
</tr>
<tr>
<td>Ctrl + End</td>
<td>跳转到页尾</td>
</tr>
<tr>
<td>Ctrl + up/down</td>
<td>行视图上下偏移</td>
</tr>
<tr>
<td>Alt + PgUp/PgDown</td>
<td>屏视图上下偏移</td>
</tr>
<tr>
<td>Ctrl + Shift + [</td>
<td>折叠区域代码</td>
</tr>
<tr>
<td>Ctrl + Shift + ]</td>
<td>展开区域代码</td>
</tr>
<tr>
<td>Ctrl + K Ctrl + [</td>
<td>折叠所有子区域代码</td>
</tr>
<tr>
<td>Ctrl + k Ctrl + ]</td>
<td>展开所有折叠的子区域代码</td>
</tr>
<tr>
<td>Ctrl + K Ctrl + 0</td>
<td>折叠所有区域代码</td>
</tr>
<tr>
<td>Ctrl + K Ctrl + J</td>
<td>展开所有折叠区域代码</td>
</tr>
<tr>
<td>Ctrl + K Ctrl + C</td>
<td>添加行注释</td>
</tr>
<tr>
<td>Ctrl + K Ctrl + U</td>
<td>删除行注释</td>
</tr>
<tr>
<td>Ctrl + /</td>
<td>添加关闭行注释</td>
</tr>
<tr>
<td>Shift + Alt +A</td>
<td>块区域注释</td>
</tr>
<tr>
<td>Alt + Z</td>
<td>添加关闭词汇包含</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="导航"><a href="#导航" class="headerlink" title="导航"></a>导航</h1><table>
<thead>
<tr>
<th>快捷键</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ctrl + T</td>
<td>列出所有符号</td>
</tr>
<tr>
<td>Ctrl + G</td>
<td>跳转行</td>
</tr>
<tr>
<td>Ctrl + P</td>
<td>跳转文件</td>
</tr>
<tr>
<td>Ctrl + Shift + O</td>
<td>跳转到符号处</td>
</tr>
<tr>
<td>Ctrl + Shift + M</td>
<td>打开问题展示面板</td>
</tr>
<tr>
<td>F8</td>
<td>跳转到下一个错误或者警告</td>
</tr>
<tr>
<td>Shift + F8</td>
<td>跳转到上一个错误或者警告</td>
</tr>
<tr>
<td>Ctrl + Shift + Tab</td>
<td>切换到最近打开的文件</td>
</tr>
<tr>
<td>Alt + left / right</td>
<td>向后、向前</td>
</tr>
<tr>
<td>Ctrl + M</td>
<td>进入用Tab来移动焦点</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="查询与替换"><a href="#查询与替换" class="headerlink" title="查询与替换"></a>查询与替换</h1><table>
<thead>
<tr>
<th>快捷键</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ctrl + F</td>
<td>查询</td>
</tr>
<tr>
<td>Ctrl + H</td>
<td>替换</td>
</tr>
<tr>
<td>F3 / Shift + F3</td>
<td>查询下一个/上一个</td>
</tr>
<tr>
<td>Alt + Enter</td>
<td>选中所有出现在查询中的</td>
</tr>
<tr>
<td>Ctrl + D</td>
<td>匹配当前选中的词汇或者行，再次选中-可操作</td>
</tr>
<tr>
<td>Ctrl + K Ctrl + D</td>
<td>移动当前选择到下个匹配选择的位置(光标选定)</td>
</tr>
<tr>
<td>Alt + C / R / W</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="多行光标操作于选择"><a href="#多行光标操作于选择" class="headerlink" title="多行光标操作于选择"></a>多行光标操作于选择</h1><table>
<thead>
<tr>
<th>快捷键</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>Alt + Click</td>
<td>插入光标-支持多个</td>
</tr>
<tr>
<td>Ctrl + Alt + up/down</td>
<td>上下插入光标-支持多个</td>
</tr>
<tr>
<td>Ctrl + U</td>
<td>撤销最后一次光标操作</td>
</tr>
<tr>
<td>Shift + Alt + I</td>
<td>插入光标到选中范围内所有行结束符</td>
</tr>
<tr>
<td>Ctrl + I</td>
<td>选中当前行</td>
</tr>
<tr>
<td>Ctrl + Shift + L</td>
<td>选择所有出现在当前选中的行-操作</td>
</tr>
<tr>
<td>Ctrl + F2</td>
<td>选择所有出现在当前选中的词汇-操作</td>
</tr>
<tr>
<td>Shift + Alt + right</td>
<td>从光标处扩展选中全行</td>
</tr>
<tr>
<td>Shift + Alt + left</td>
<td>收缩选择区域</td>
</tr>
<tr>
<td>Shift + Alt + (drag mouse)</td>
<td>鼠标拖动区域，同时在多个行结束符插入光标</td>
</tr>
<tr>
<td>Ctrl + Shift + Alt + (Arrow Key)</td>
<td>也是插入多行光标的[方向键控制]</td>
</tr>
<tr>
<td>Ctrl + Shift + Alt + PgUp/PgDown</td>
<td>也是插入多行光标的[整屏生效]</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="丰富的语言操作"><a href="#丰富的语言操作" class="headerlink" title="丰富的语言操作"></a>丰富的语言操作</h1><table>
<thead>
<tr>
<th>快捷键</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ctrl + Space</td>
<td>输入建议[智能提示]</td>
</tr>
<tr>
<td>Ctrl + Shift + Space</td>
<td>参数提示</td>
</tr>
<tr>
<td>Tab</td>
<td>Emmet指令触发/缩进</td>
</tr>
<tr>
<td>Shift + Alt + F</td>
<td>格式化代码</td>
</tr>
<tr>
<td>Ctrl + K Ctrl + F</td>
<td>格式化选中部分的代码</td>
</tr>
<tr>
<td>F12</td>
<td>跳转到定义处</td>
</tr>
<tr>
<td>Alt + F12</td>
<td>代码片段显示定义</td>
</tr>
<tr>
<td>Ctrl + K F12</td>
<td>在其他窗口打开定义处</td>
</tr>
<tr>
<td>Ctrl + .</td>
<td>快速修复部分可以修复的语法错误</td>
</tr>
<tr>
<td>Shift + F12</td>
<td>显示所有引用</td>
</tr>
<tr>
<td>F2</td>
<td>重命名符号</td>
</tr>
<tr>
<td>Ctrl + Shift + . / ,</td>
<td>替换下个值</td>
</tr>
<tr>
<td>Ctrl + K Ctrl + X</td>
<td>移除空白字符</td>
</tr>
<tr>
<td>Ctrl + K M</td>
<td>更改页面文档格式</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="编辑器管理"><a href="#编辑器管理" class="headerlink" title="编辑器管理"></a>编辑器管理</h1><table>
<thead>
<tr>
<th>快捷键</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ctrl + F4, Ctrl + W</td>
<td>关闭编辑器</td>
</tr>
<tr>
<td>Ctrl + k F</td>
<td>关闭当前打开的文件夹</td>
</tr>
<tr>
<td>Ctrl + \</td>
<td>切割编辑窗口</td>
<td></td>
</tr>
<tr>
<td>Ctrl + 1/2/3</td>
<td>切换焦点在不同的切割窗口</td>
</tr>
<tr>
<td>Ctrl + K Ctrl &lt;-/-&gt;</td>
<td>切换焦点在不同的切割窗口</td>
</tr>
<tr>
<td>Ctrl + Shift + PgUp/PgDown</td>
<td>切换标签页的位置</td>
</tr>
<tr>
<td>Ctrl + K &lt;-/-&gt;</td>
<td>切割窗口位置调换</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="文件管理"><a href="#文件管理" class="headerlink" title="文件管理"></a>文件管理</h1><table>
<thead>
<tr>
<th>快捷键</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ctrl + N</td>
<td>新建文件</td>
</tr>
<tr>
<td>Ctrl + O</td>
<td>打开文件</td>
</tr>
<tr>
<td>Ctrl + S</td>
<td>保存文件</td>
</tr>
<tr>
<td>Ctrl + Shift + S</td>
<td>另存为</td>
</tr>
<tr>
<td>Ctrl + K S</td>
<td>保存所有当前已经打开的文件</td>
</tr>
<tr>
<td>Ctrl + F4</td>
<td>关闭当前编辑窗口</td>
</tr>
<tr>
<td>Ctrl + K Ctrl + W</td>
<td>关闭所有编辑窗口</td>
</tr>
<tr>
<td>Ctrl + Shift + T</td>
<td>撤销最近关闭的一个文件编辑窗口</td>
</tr>
<tr>
<td>Ctrl + K Enter</td>
<td>保持开启</td>
</tr>
<tr>
<td>Ctrl + Shift + Tab</td>
<td>调出最近打开的文件列表，重复按会切换</td>
</tr>
<tr>
<td>Ctrl + Tab</td>
<td>与上面一致，顺序不一致</td>
</tr>
<tr>
<td>Ctrl + K P</td>
<td>复制当前打开文件的存放路径</td>
</tr>
<tr>
<td>Ctrl + K R</td>
<td>打开当前编辑文件存放位置【文件管理器】</td>
</tr>
<tr>
<td>Ctrl + K O</td>
<td>在新的编辑器中打开当前编辑的文件</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="显示"><a href="#显示" class="headerlink" title="显示"></a>显示</h1><table>
<thead>
<tr>
<th>快捷键</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>F11</td>
<td>切换全屏模式</td>
</tr>
<tr>
<td>Shift + Alt + 1</td>
<td>切换编辑布局【目前无效】</td>
</tr>
<tr>
<td>Ctrl + =/-</td>
<td>放大 / 缩小</td>
</tr>
<tr>
<td>Ctrl + B</td>
<td>侧边栏显示隐藏</td>
</tr>
<tr>
<td>Ctrl + Shift + E</td>
<td>资源视图和编辑视图的焦点切换</td>
</tr>
<tr>
<td>Ctrl + Shift + F</td>
<td>打开全局搜索</td>
</tr>
<tr>
<td>Ctrl + Shift + G</td>
<td>打开Git可视管理</td>
</tr>
<tr>
<td>Ctrl + Shift + D</td>
<td>打开DeBug面板</td>
</tr>
<tr>
<td>Ctrl + Shift + X</td>
<td>打开插件市场面板</td>
</tr>
<tr>
<td>Ctrl + Shift + H</td>
<td>在当前文件替换查询替换</td>
</tr>
<tr>
<td>Ctrl + Shift + J</td>
<td>开启详细查询</td>
</tr>
<tr>
<td>Ctrl + Shift + V</td>
<td>预览Markdown文件【编译后】</td>
</tr>
<tr>
<td>Ctrl + K v</td>
<td>在边栏打开渲染后的视图【新建】</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h1><table>
<thead>
<tr>
<th>快捷键</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>F9</td>
<td>添加解除断点</td>
</tr>
<tr>
<td>F5</td>
<td>启动调试、继续</td>
</tr>
<tr>
<td>F11 / Shift + F11</td>
<td>单步进入 / 单步跳出</td>
</tr>
<tr>
<td>F10</td>
<td>单步跳过</td>
</tr>
<tr>
<td>Ctrl + K Ctrl + I</td>
<td>显示悬浮</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="集成终端"><a href="#集成终端" class="headerlink" title="集成终端"></a>集成终端</h1><table>
<thead>
<tr>
<th>快捷键</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ctrl + `</td>
<td>打开集成终端</td>
</tr>
<tr>
<td>Ctrl + Shift + `</td>
<td>创建一个新的终端</td>
</tr>
<tr>
<td>Ctrl + Shift + C</td>
<td>复制所选</td>
</tr>
<tr>
<td>Ctrl + Shift + V</td>
<td>复制到当前激活的终端</td>
</tr>
<tr>
<td>Shift + PgUp / PgDown</td>
<td>页面上下翻屏</td>
</tr>
<tr>
<td>Ctrl + Home / End</td>
<td>滚动到页面头部或尾部</td>
</tr>
</tbody>
</table>
<hr>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/24/计算机网络/tcp-congestion2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WeetCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/24/计算机网络/tcp-congestion2/" itemprop="url">
                  TCP拥塞控制2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-24 15:20:23 / Modified: 15:21:10" itemprop="dateCreated datePublished" datetime="2018-06-24T15:20:23+08:00">2018-06-24</time>
            

            
              

              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/24/计算机网络/tcp-congestion2/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/24/计算机网络/tcp-congestion2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h2 id="TCP的拥塞控制"><a href="#TCP的拥塞控制" class="headerlink" title="TCP的拥塞控制"></a>TCP的拥塞控制</h2><p>转载自网络</p>
<p>来源：<a href="https://zhangbinalan.gitbooks.io/protocol/content/tcpde_yong_sai_kong_zhi.html" target="_blank" rel="noopener">gitbook</a></p>
<h3 id="拥塞控制与流量控制"><a href="#拥塞控制与流量控制" class="headerlink" title="拥塞控制与流量控制"></a>拥塞控制与流量控制</h3><p>拥塞控制：防止过多的数据注入到网络中，这样可以使网络中的路由器或链路不致过载。拥塞控制所要做的都有一个前提：网络能够承受现有的网络负荷。拥塞控制是一个全局性的过程，涉及到所有的主机、路由器，以及与降低网络传输性能有关的所有因素</p>
<p>流量控制：指点对点通信量的控制，是端到端正的问题。流量控制所要做的就是抑制发送端发送数据的速率，以便使接收端来得及接收</p>
<p>拥塞控制代价：需要获得网络内部流量分布的信息。在实施拥塞控制之前，还需要在结点之间交换信息和各种命令，以便选择控制的策略和实施控制。这样就产生了额外的开销。拥塞控制还需要将一些资源分配给各个用户单独使用，使得网络资源不能更好地实现共享。</p>
<h3 id="几种拥塞控制方法"><a href="#几种拥塞控制方法" class="headerlink" title="几种拥塞控制方法"></a>几种拥塞控制方法</h3><p>慢开始( slow-start )、拥塞避免( congestion avoidance )、快重传( fast retransmit )和快恢复( fast recovery )。</p>
<h4 id="慢开始和拥塞避免"><a href="#慢开始和拥塞避免" class="headerlink" title="慢开始和拥塞避免"></a>慢开始和拥塞避免</h4><p>发送方维持一个拥塞窗口 cwnd ( congestion window )的状态变量。拥塞窗口的大小取决于网络的拥塞程度，并且动态地在变化。发送方让自己的发送窗口等于拥塞</p>
<p>发送方控制拥塞窗口的原则是：只要网络没有出现拥塞，拥塞窗口就再增大一些，以便把更多的分组发送出去。但只要网络出现拥塞，拥塞窗口就减小一些，以减少注入到网络中的分组数</p>
<ol>
<li>慢开始算法<br>慢开始算法：当主机开始发送数据时，如果立即所大量数据字节注入到网络，那么就有可能引起网络拥塞，因为现在并不清楚网络的负荷情况。因此，较好的方法是先探测一下，即由小到大逐渐增大发送窗口，也就是说，由小到大逐渐增大拥塞窗口数值。通常在刚刚开始发送报文段时，先把拥塞窗口 cwnd 设置为一个最大报文段MSS的数值。而在每收到一个对新的报文段的确认后，把拥塞窗口增加至多一个MSS的数值。用这样的方法逐步增大发送方的拥塞窗口<br>cwnd ，可以使分组注入到网络的速率更加合理<br><img src="https://zhangbinalan.gitbooks.io/protocol/content/10.jpg" alt="img"><br>每经过一个传输轮次，拥塞窗口 cwnd 就加倍。一个传输轮次所经历的时间其实就是往返时间RTT。不过“传输轮次”更加强调：把拥塞窗口cwnd所允许发送的报文段都连续发送出去，并收到了对已发送的最后一个字节的确认<br>另，慢开始的“慢”并不是指cwnd的增长速率慢，而是指在TCP开始发送报文段时先设置cwnd=1，使得发送方在开始时只发送一个报文段（目的是试探一下网络的拥塞情况），然后再逐渐增大cwnd<br>为了防止拥塞窗口cwnd增长过大引起网络拥塞，还需要设置一个慢开始门限ssthresh状态变量（如何设置ssthresh）。慢开始门限ssthresh的用法如下：<br> 当 cwnd &lt; ssthresh 时，使用上述的慢开始算法<br> 当 cwnd &gt; ssthresh 时，停止使用慢开始算法而改用拥塞避免算法<br> 当 cwnd = ssthresh 时，既可使用慢开始算法，也可使用拥塞控制避免算法</li>
<li>拥塞避免算法<br>让拥塞窗口cwnd缓慢地增大，即每经过一个往返时间RTT就把发送方的拥塞窗口cwnd加1，而不是加倍。这样拥塞窗口cwnd按线性规律缓慢增长，比慢开始算法的拥塞窗口增长速率缓慢得多<br>无论在慢开始阶段还是在拥塞避免阶段，只要发送方判断网络出现拥塞（其根据就是没有收到确认），就要把慢开始门限ssthresh设置为出现拥塞时的发送方窗口值的一半（但不能小于2）。然后把拥塞窗口cwnd重新设置为1，执行慢开始算法。这样做的目的就是要迅速减少主机发送到网络中的分组数，使得发生拥塞的路由器有足够时间把队列中积压的分组处理完毕<br>如下图，用具体数值说明了上述拥塞控制的过程。现在发送窗口的大小和拥塞窗口一样大<br><img src="https://zhangbinalan.gitbooks.io/protocol/content/11.jpg" alt="img"><br>1:当TCP连接进行初始化时，把拥塞窗口cwnd置为1。前面已说过，为了便于理解，图中的窗口单位不使用字节而使用报文段的个数。慢开始门限的初始值设置为16个报文段，即 cwnd = 16<br>2:在执行慢开始算法时，拥塞窗口 cwnd<br>的初始值为1。以后发送方每收到一个对新报文段的确认ACK，就把拥塞窗口值另1，然后开始下一轮的传输（图中横坐标为传输轮次）。因此拥塞窗口cwnd随着传输轮次按指数规律增长。当拥塞窗口cwnd增长到慢开始门限值ssthresh时（即当cwnd=16时），就改为执行拥塞控制算法，拥塞窗口按线性规律增长<br>3:假定拥塞窗口的数值增长到24时，网络出现超时（这很可能就是网络发生拥塞了）。更新后的ssthresh值变为12（即变为出现超时时的拥塞窗口数值24的一半），拥塞窗口再重新设置为1，并执行慢开始算法。当cwnd=ssthresh=12时改为执行拥塞避免算法，拥塞窗口按线性规律增长，每经过一个往返时间增加一个MSS的大小<br>4:强调：“拥塞避免”并非指完全能够避免了拥塞。利用以上的措施要完全避免网络拥塞还是不可能的。“拥塞避免”是说在拥塞避免阶段将拥塞窗口控制为按线性规律增长，使网络比较不容易出现拥塞</li>
</ol>
<h4 id="快重传和快恢复"><a href="#快重传和快恢复" class="headerlink" title="快重传和快恢复"></a>快重传和快恢复</h4><p>如果发送方设置的超时计时器时限已到但还没有收到确认，那么很可能是网络出现了拥塞，致使报文段在网络中的某处被丢弃。这时，TCP马上把拥塞窗口 cwnd 减小到1，并执行慢开始算法，同时把慢开始门限值ssthresh减半。这是不使用快重传的情况</p>
<ol>
<li><p>快重传算法</p>
<p>快重传算法首先要求接收方每收到一个失序的报文段后就立即发出重复确认（为的是使发送方及早知道有报文段没有到达对方）而不要等到自己发送数据时才进行捎带确认<br><img src="https://zhangbinalan.gitbooks.io/protocol/content/13.jpg" alt="img"><br>接收方收到了M1和M2后都分别发出了确认。现在假定接收方没有收到M3但接着收到了M4。显然，接收方不能确认M4，因为M4是收到的失序报文段。根据可靠传输原理，接收方可以什么都不做，也可以在适当时机发送一次对M2的确认。但按照快重传算法的规定，接收方应及时发送对M2的重复确认，这样做可以让发送方及早知道报文段M3没有到达接收方。发送方接着发送了M5和M6。接收方收到这两个报文后，也还要再次发出对M2的重复确认。这样，发送方共收到了接收方的四个对M2的确认，其中后三个都是重复确认。快重传算法还规定，发送方只要一连收到三个重复确认就应当立即重传对方尚未收到的报文段M3，而不必继续等待M3设置的重传计时器到期。由于发送方尽早重传未被确认的报文段，因此采用快重传后可以使整个网络吞吐量提高约20%</p>
</li>
<li><p>快恢复算法<br>快恢复算法，其过程有以下两个要点：<br>1:当发送方连续收到三个重复确认，就执行“乘法减小”算法，把慢开始门限ssthresh减半。这是为了预防网络发生拥塞。请注意：接下去不执行慢开始算法。<br>2:由于发送方现在认为网络很可能没有发生拥塞，因此与慢开始不同之处是现在不执行慢开始算法（即拥塞窗口cwnd现在不设置为1），而是把cwnd值设置为慢开始门限ssthresh减半后的数值，然后开始执行拥塞避免算法（“加法增大”），使拥塞窗口缓慢地线性增大。<br>下图给出了快重传和快恢复的示意图，并标明了“TCP Reno版本”。<br>区别：新的 TCP Reno 版本在快重传之后采用快恢复算法而不是采用慢开始算法。<br><img src="https://zhangbinalan.gitbooks.io/protocol/content/14.jpg" alt="img"><br>也有的快重传实现是把开始时的拥塞窗口cwnd值再增大一点，即等于 ssthresh + 3 X MSS .</p>
<p>这样做的理由是：既然发送方收到三个重复的确认，就表明有三个分组已经离开了网络。这三个分组不再消耗网络 的资源而是停留在接收方的缓存中。可见现在网络中并不是堆积了分组而是减少了三个分组。因此可适当把拥塞窗口扩大了些在采用快恢复算法时，慢开始算法只是在TCP连接建立时和网络出现超时时才使用<br> 采用这样的拥塞控制方法使得TCP的性能有明显的改进<br> 接收方根据自己的接收能力设定了接收窗口rwnd，并把这个窗口值写入TCP首部中的窗口字段，传送给发送方。因此，接收窗口又称为通知窗口。因此，从接收方对发送方的流量控制的角度考虑，发送方的发送窗口一定不能超过对方给出的接收窗口rwnd<br> 发送方窗口的上限值 = Min [ rwnd, cwnd ]<br> 当rwnd &lt; cwnd 时，是接收方的接收能力限制发送方窗口的最大值。<br> 当cwnd &lt; rwnd 时，则是网络的拥塞限制发送方窗口的最大值。</p>
</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/24/C和C++/字节对齐/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WeetCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/24/C和C++/字节对齐/" itemprop="url">
                  字节对齐
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-24 15:14:12" itemprop="dateCreated datePublished" datetime="2018-06-24T15:14:12+08:00">2018-06-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-07-24 15:15:09" itemprop="dateModified" datetime="2018-07-24T15:15:09+08:00">2018-07-24</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/24/C和C++/字节对齐/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/24/C和C++/字节对齐/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <h2 id="C语言的数据对齐"><a href="#C语言的数据对齐" class="headerlink" title="C语言的数据对齐"></a>C语言的数据对齐</h2><p><strong>什么是数据对齐？为什么要数据对齐？</strong></p>
<p>如果一个变量的地址是该变量的长度的整数倍的话，则数据对齐。<br>数据对齐的好处是可以加快CPU读取数据的速度。比如x86的CPU的数据读取有三种方式：</p>
<ul>
<li>按字节读取</li>
<li>按半字读取</li>
<li>按字读取</li>
</ul>
<p>如果地址是对齐的，那么CPU会寻找最佳的数据读取方式，可以一次就完成数据的读取。<br>如果地址不是对齐的，那么可能需要分几个步骤才能读完。</p>
<p><strong>例子</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">stu</span>&#123;</span></span><br><span class="line">　　 <span class="keyword">char</span> sex;</span><br><span class="line">　　 <span class="keyword">int</span> length;</span><br><span class="line">　　 <span class="keyword">char</span> name[<span class="number">10</span>];</span><br><span class="line">　　&#125;;</span><br><span class="line">　　<span class="class"><span class="keyword">struct</span> <span class="title">stu</span> <span class="title">my_stu</span>;</span></span><br></pre></td></tr></table></figure>
<p>一般编译器都会进行数据对齐操作，gcc默认是4字节对齐，结构体的数据对齐有两点：</p>
<ul>
<li>使每个结构成员数据对齐</li>
<li>使结构体整体数据对齐</li>
</ul>
<p>这样可以知道：</p>
<p>char sex        –&gt; 4字节<br>int  length     –&gt; 4字节<br>char name[10]   –&gt; 10字节</p>
<p>为了对齐结构体，因此还需要在结构体后面补两个字节，从而实现对齐。即结构体总共占用4+4+10+2 = 20字节</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/23/计算机网络/tcp-congestion/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WeetCheng">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/23/计算机网络/tcp-congestion/" itemprop="url">
                  TCP拥塞控制
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-06-23 17:26:15" itemprop="dateCreated datePublished" datetime="2018-06-23T17:26:15+08:00">2018-06-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-06-24 15:24:35" itemprop="dateModified" datetime="2018-06-24T15:24:35+08:00">2018-06-24</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/23/计算机网络/tcp-congestion/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/06/23/计算机网络/tcp-congestion/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        
          
            <p>​    </p>
<p>转载自网络</p>
<p>来源：<a href="https://www.cnblogs.com/fll/archive/2008/06/10/1217013.html" target="_blank" rel="noopener">网络拥塞控制(三) TCP拥塞控制算法</a></p>
<p>作者：<a href="http://www.cnblogs.com/fll/" target="_blank" rel="noopener">海阔天空</a></p>
<p>为了防止网络的拥塞现象，TCP提出了一系列的拥塞控制机制。最初由V. Jacobson在1988年的论文中提出的TCP的拥塞控制由“慢启动(Slow start)”和“拥塞避免(Congestion avoidance)”组成，后来TCP Reno版本中又针对性的加入了“快速重传(Fast retransmit)”、“快速恢复(Fast Recovery)”算法，再后来在TCP NewReno中又对“快速恢复”算法进行了改进，近些年又出现了选择性应答( selective acknowledgement,SACK)算法，还有其他方面的大大小小的改进，成为网络研究的一个热点。</p>
<p>TCP的拥塞控制主要原理依赖于一个拥塞窗口(cwnd)来控制，在之前我们还讨论过TCP还有一个对端通告的接收窗口(rwnd)用于流量控制。窗口值的大小就代表能够发送出去的但还没有收到ACK的最大数据报文段，显然窗口越大那么数据发送的速度也就越快，但是也有越可能使得网络出现拥塞，如果窗口值为1，那么就简化为一个停等协议，每发送一个数据，都要等到对方的确认才能发送第二个数据包，显然数据传输效率低下。TCP的拥塞控制算法就是要在这两者之间权衡，选取最好的cwnd值，从而使得网络吞吐量最大化且不产生拥塞。</p>
<p>由于需要考虑拥塞控制和流量控制两个方面的内容，因此TCP的真正的发送窗口=min(rwnd, cwnd)。但是rwnd是由对端确定的，网络环境对其没有影响，所以在考虑拥塞的时候我们一般不考虑rwnd的值，我们暂时只讨论如何确定cwnd值的大小。关于cwnd的单位，在TCP中是以字节来做单位的，我们假设TCP每次传输都是按照MSS大小来发送数据的，因此你可以认为cwnd按照数据包个数来做单位也可以理解，所以有时我们说cwnd增加1也就是相当于字节数增加1个MSS大小。</p>
<p>慢启动：最初的TCP在连接建立成功后会向网络中发送大量的数据包，这样很容易导致网络中路由器缓存空间耗尽，从而发生拥塞。因此新建立的连接不能够一开始就大量发送数据包，而只能根据网络情况逐步增加每次发送的数据量，以避免上述现象的发生。具体来说，当新建连接时，cwnd初始化为1个最大报文段(MSS)大小，发送端开始按照拥塞窗口大小发送数据，每当有一个报文段被确认，cwnd就增加1个MSS大小。这样cwnd的值就随着网络往返时间(Round Trip Time,RTT)呈指数级增长，事实上，慢启动的速度一点也不慢，只是它的起点比较低一点而已。我们可以简单计算下：</p>
<blockquote>
<p>   开始           —&gt;     cwnd = 1</p>
<p>   经过1个RTT后   —&gt;     cwnd = 2*1 = 2</p>
<p>   经过2个RTT后   —&gt;     cwnd = 2*2= 4</p>
<p>   经过3个RTT后   —&gt;     cwnd = 4*2 = 8</p>
</blockquote>
<p>如果带宽为W，那么经过RTT*log2W时间就可以占满带宽。</p>
<p>拥塞避免：从慢启动可以看到，cwnd可以很快的增长上来，从而最大程度利用网络带宽资源，但是cwnd不能一直这样无限增长下去，一定需要某个限制。TCP使用了一个叫慢启动门限(ssthresh)的变量，当cwnd超过该值后，慢启动过程结束，进入拥塞避免阶段。对于大多数TCP实现来说，ssthresh的值是65536(同样以字节计算)。拥塞避免的主要思想是加法增大，也就是cwnd的值不再指数级往上升，开始加法增加。此时当窗口中所有的报文段都被确认时，cwnd的大小加1，cwnd的值就随着RTT开始线性增加，这样就可以避免增长过快导致网络拥塞，慢慢的增加调整到网络的最佳值。</p>
<p>上面讨论的两个机制都是没有检测到拥塞的情况下的行为，那么当发现拥塞了cwnd又该怎样去调整呢？</p>
<p>首先来看TCP是如何确定网络进入了拥塞状态的，TCP认为网络拥塞的主要依据是它重传了一个报文段。上面提到过，TCP对每一个报文段都有一个定时器，称为重传定时器(RTO)，当RTO超时且还没有得到数据确认，那么TCP就会对该报文段进行重传，当发生超时时，那么出现拥塞的可能性就很大，某个报文段可能在网络中某处丢失，并且后续的报文段也没有了消息，在这种情况下，TCP反应比较“强烈”：</p>
<p>1.把ssthresh降低为cwnd值的一半</p>
<p>2.把cwnd重新设置为1</p>
<p>3.重新进入慢启动过程。</p>
<p>从整体上来讲，TCP拥塞控制窗口变化的原则是AIMD原则，即加法增大、乘法减小。可以看出TCP的该原则可以较好地保证流之间的公平性，因为一旦出现丢包，那么立即减半退避，可以给其他新建的流留有足够的空间，从而保证整个的公平性。</p>
<p>其实TCP还有一种情况会进行重传：那就是收到3个相同的ACK。TCP在收到乱序到达包时就会立即发送ACK，TCP利用3个相同的ACK来判定数据包的丢失，此时进行快速重传，快速重传做的事情有：</p>
<blockquote>
<p>1.把ssthresh设置为cwnd的一半</p>
<p>2.把cwnd再设置为ssthresh的值(具体实现有些为ssthresh+3)</p>
<p>3.重新进入拥塞避免阶段。</p>
</blockquote>
<p>后来的“快速恢复”算法是在上述的“快速重传”算法后添加的，当收到3个重复ACK时，TCP最后进入的不是拥塞避免阶段，而是快速恢复阶段。快速重传和快速恢复算法一般同时使用。快速恢复的思想是“数据包守恒”原则，即同一个时刻在网络中的数据包数量是恒定的，只有当“老”数据包离开了网络后，才能向网络中发送一个“新”的数据包，如果发送方收到一个重复的ACK，那么根据TCP的ACK机制就表明有一个数据包离开了网络，于是cwnd加1。如果能够严格按照该原则那么网络中很少会发生拥塞，事实上拥塞控制的目的也就在修正违反该原则的地方。</p>
<p>具体来说快速恢复的主要步骤是：</p>
<blockquote>
<p>1.当收到3个重复ACK时，把ssthresh设置为cwnd的一半，把cwnd设置为ssthresh的值加3，然后重传丢失的报文段，加3的原因是因为收到3个重复的ACK，表明有3个“老”的数据包离开了网络。 </p>
<p>2.再收到重复的ACK时，拥塞窗口增加1。</p>
<p>3.当收到新的数据包的ACK时，把cwnd设置为第一步中的ssthresh的值。原因是因为该ACK确认了新的数据，说明从重复ACK时的数据都已收到，该恢复过程已经结束，可以回到恢复之前的状态了，也即再次进入拥塞避免状态。</p>
</blockquote>
<p>快速重传算法首次出现在4.3BSD的Tahoe版本，快速恢复首次出现在4.3BSD的Reno版本，也称之为Reno版的TCP拥塞控制算法。</p>
<p>可以看出Reno的快速重传算法是针对一个包的重传情况的，然而在实际中，一个重传超时可能导致许多的数据包的重传，因此当多个数据包从一个数据窗口中丢失时并且触发快速重传和快速恢复算法时，问题就产生了。因此NewReno出现了，它在Reno快速恢复的基础上稍加了修改，可以恢复一个窗口内多个包丢失的情况。具体来讲就是：Reno在收到一个新的数据的ACK时就退出了快速恢复状态了，而NewReno需要收到该窗口内所有数据包的确认后才会退出快速恢复状态，从而更一步提高吞吐量。</p>
<p>SACK就是改变TCP的确认机制，最初的TCP只确认当前已连续收到的数据，SACK则把乱序等信息会全部告诉对方，从而减少数据发送方重传的盲目性。比如说序号1，2，3，5，7的数据收到了，那么普通的ACK只会确认序列号4，而SACK会把当前的5，7已经收到的信息在SACK选项里面告知对端，从而提高性能，当使用SACK的时候，NewReno算法可以不使用，因为SACK本身携带的信息就可以使得发送方有足够的信息来知道需要重传哪些包，而不需要重传哪些包。</p>
<p>以上方面资料可以参考<a href="http://ee.lbl.gov/papers/congavoid.pdf" target="_blank" rel="noopener">V. Jacobson的论文</a>，<a href="http://www.faqs.org/rfcs/rfc2001.html" target="_blank" rel="noopener">RFC2001</a>、<a href="http://www.faqs.org/rfcs/rfc2018.html" target="_blank" rel="noopener">RFC2018</a>、<a href="http://www.faqs.org/rfcs/rfc2581.html" target="_blank" rel="noopener">RFC2581</a>、<a href="http://www.ietf.org/rfc/rfc2582.txt" target="_blank" rel="noopener">RFC2582</a>、<a href="http://www.faqs.org/rfcs/rfc2883.html" target="_blank" rel="noopener">RFC2883</a>等文献。</p>
<p>下一节：TCP拥塞控制的其他方面</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">WeetCheng</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">80</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">2</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">20</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">WeetCheng</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Gemini</a> v6.4.2</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="Total Visitors">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="Total Views">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.2"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.2"></script>



  

  
    <script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script>
  

  





  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
